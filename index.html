<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Theme switcher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./style.css">
  </head>

  <body>
      <div class="container">
        <h1>Pick a theme</h1>
      <div class="theme-switcher">
        <button data-theme="green" aria-pressed="true">Green</button>
        <button data-theme="blue" aria-pressed="false">Blue</button>
        <button data-theme="pink" aria-pressed="false">Pink</button>
        <button data-theme="orange" aria-pressed="false">Orange</button>
      </div>
      <p>Find the tutorial soon on <a href="https://fossheim.io">fossheim.io</a></p>
      </div>

  <script>

    const pressedButtonSelector = '[data-theme][aria-pressed="true"]';
    const prefersColorMediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
    const themes = {
      saved: localStorage.getItem('selected-theme'),
      dark: 'blue', // Theme to load when prefers-colors-scheme = light
      light: 'pink', // Theme to load when prefers-colors-scheme = dark
      default: 'orange' // Theme to load when prefers-colors-scheme isnâ€™t supported
    };

    const applyTheme = (theme) => {
      const target = document.querySelector(`[data-theme="${theme}"]`);
      document.documentElement.setAttribute("data-selected-theme", theme);
      document.querySelector(pressedButtonSelector).setAttribute('aria-pressed', 'false');
      target.setAttribute('aria-pressed', 'true');
    };

    const handleThemeSelection = (event) => {
      const target = event.target;
      const isPressed = target.getAttribute('aria-pressed');
      
      if(isPressed !== "true") {
        const theme = target.getAttribute('data-theme');        
        applyTheme(theme);
        localStorage.setItem('selected-theme', theme);
      }
    }
    
    const setDefaultTheme = () => {
      themes.default = (prefersColorMediaQuery.matches === true) ? themes.dark : themes.light
    }

    const applyInitialTheme = () => {
      if(themes.saved && themes.saved !== themes.default) {
        applyTheme(themes.saved);
        return;
      }
      applyTheme(themes.default);
    };

    setDefaultTheme();
    applyInitialTheme();

    const themeSwitcher = document.querySelector('.theme-switcher');
    const buttons = themeSwitcher.querySelectorAll('button');

    buttons.forEach((button) => {
      button.addEventListener('click', handleThemeSelection);
    });
    
    prefersColorMediaQuery.addEventListener('change', () => {
      setDefaultTheme();
      applyInitialTheme();
    });



  </script>

  </body>
</html>